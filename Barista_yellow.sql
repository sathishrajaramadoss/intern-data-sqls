SELECT offer_id, COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 345 % 63) & Taggroup6Flags > 0) THEN Id END)) AS [Hokkaido],
       COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 372 % 63) & Taggroup6Flags > 0) THEN Id END)) AS [Aomori],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 373 % 63) & Taggroup6Flags > 0) THEN Id END)) AS [Iwate],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 374 % 63) & Taggroup6Flags > 0) THEN Id END)) AS [Miyagi],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 375 % 63) & Taggroup6Flags > 0) THEN Id END)) AS [Akita],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 376 % 63) & Taggroup6Flags > 0) THEN Id END)) AS [Yamagata],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 377 % 63) & Taggroup6Flags > 0) THEN Id END)) AS [Fukushima],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 378 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Ibaraki],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 379 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Tochigi],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 380 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Gunma],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 381 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Saitama],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 382 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Chiba],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 383 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Tokyo],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 384 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Kanagawa],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 385 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Niigata],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 386 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Toyama],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 387 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Ishikawa],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 388 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Fukui],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 389 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Yamanashi],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 390 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Nagano],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 391 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Gifu],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 392 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Shizuoka],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 393 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Aichi],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 394 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Mie],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 395 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Shiga],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 396 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Kyoto],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 397 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Osaka],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 398 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Hyogo],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 399 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Nara],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 400 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Wakayama],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 401 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Tottori],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 402 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Shimane],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 403 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Okayama],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 404 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Hiroshima],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 405 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Yamaguchi],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 406 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Tokushima],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 407 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Kagawa],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 408 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Ehime],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 409 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Kochi],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 410 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Fukuoka],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 411 % 63) & TagGroup7Flags > 0) THEN Id END)) AS [Saga],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 412 % 63) & TagGroup7Flags > 0) THEN Id END)) AS [Nagasaki],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 413 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Kumamoto],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 414 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Oita],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 415 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Miyazaki],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 416 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Kagoshima],
	   COUNT(DISTINCT(CASE WHEN (POWER(CONVERT(BIGINT, 2), 417 % 63) & Taggroup7Flags > 0) THEN Id END)) AS [Okinawa],
	   count(DISTINCT Id) as Total
FROM [dbo].[Consumer] aa
inner join #temp1 bb 
on aa.id=bb.consumer_id
where offer_id In (10784,10788,10790,10793,10987,10988,10989,11239,11240,11241,
					11242,11353,11354,11355,11356,11661,11662,11663,11664,11733,
					11734,11735,11660,11919,11920,11918,11921,12082,12083,12084,
					12308,12306,12307,12304,12305,12637,12638,12639,12640,12777,
					12778,12779,12780,12781,12782,12783,12784,13046,13047,13048,
					13049,13178,13180,13181,13189,13312,13313,13314,13315,13410,
					13415,13428,13431,13581,13582,13583,13584,13772,13773,13775,
					13776,13769,13771,13935,13932,13936,13933,14116,14117,14118,
					14119,14283,14284,14286,14285,14644,14647,14646,14645,14781,
					14782,14783,14784)
and [offer_redemption]>0
group by offer_id
order by offer_id

select * into #temp1 from [dbo].[Activity_Offer]
where offer_id IN (10784,10788,10790,10793,10987,10988,10989,11239,11240,11241,
					11242,11353,11354,11355,11356,11661,11662,11663,11664,11733,
					11734,11735,11660,11919,11920,11918,11921,12082,12083,12084,
					12308,12306,12307,12304,12305,12637,12638,12639,12640,12777,
					12778,12779,12780,12781,12782,12783,12784,13046,13047,13048,
					13049,13178,13180,13181,13189,13312,13313,13314,13315,13410,
					13415,13428,13431,13581,13582,13583,13584,13772,13773,13775,
					13776,13769,13771,13935,13932,13936,13933,14116,14117,14118,
					14119,14283,14284,14286,14285,14644,14647,14646,14645,14781,
					14782,14783,14784)
drop table #temp1

